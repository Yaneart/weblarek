
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

##### Данные

Интерфейсы данных, которые были разработаны при разборе проекта:

Описывает структуру данных отдельного товара в каталоге.
Товар:
interface IProduct {
id: string; --- `Уникальный идентификатор товара`
description: string; --- `Подробное описание товара`
image: string; --- `Ссылка на изображение товара`
title: string; --- `Название товара`
category: string; --- `Категория товарa`
price: number | null; --- `Цена товара. Может быть null, если цена не установлена.`
}

Описывает структуру данных, которые пользователь указывает при оформлении заказа.
Покупатель:
interface IBuyer {
payment: TPayment; --- `Выбранный способ оплаты`
email: string; --- `Адрес электронной почты`
phone: string; --- `Номер телефона`
address: string; --- `Адрес доставки`
}

###### Модели данных

Для работы с данными в приложении реализованы три класса-модели.

1. Класс ProductList каталог товаров

Свойства класса ProductList:

`items: IProduct[]` --- Хранит массив всех товаров;
`preview: string | null` --- хранит товар, выбранный для подробного отображения.

Методы класса ProductList:

`setProducts(items: IProduct[])` --- сохранения массива товаров полученного в параметрах метода;
`getProducts(): IProduct[]` --- получение массива товаров из модели;
`getProduct(id: string): IProduct | null` --- получение одного товара по его id;
`setPreview(productId: string)` --- сохранения товара для подробного отображения;
`getPreview(): IProduct | null` --- получение товара для подробного отображения.

2. Класс Cart корзина товаров

Свойства класса Cart:

`items: IProduct[]` --- хранит массив товаров, выбранных покупателем для покупки;

Методый класса Cart:

`addItem(item: IProduct)` --- добавление товара, который был получен в параметре в массив корзины;
`removeItem(id: string)` --- удаление товара, полученного в параметре из массива корзины;
`clearCart()` --- очистка корзины;
`getTotalPrice()` --- получение стоимости всех товаров в корзине;
`getTotalCount()` --- получение количества товаров в корзине;
`checkProductInCart(id: string)` --- проверка наличия товара в корзине по его id, полученному в параметр метода.

3. Класс Order данные покупателя

Свойства класса Order :

`payment: TPayment` --- вид оплаты;
`address: string` --- адреc;
`phone: string` --- телефон;
`email: string` --- email.

Методы класса Order :

`setOrderFields(fields: Partial<IBuyer>)`
`setPayment(payment: TPayment)`
`setAddress(address: string)` --- сохранение данных в модели. Один общий метод или отдельные методы для каждого поля;
`setPhone(phone: string)`
`setEmail(email: string)`

`getOrderData(): IBuyer` --- получение всех данных покупателя;
`clearOrder()` --- очистка данных покупателя;
`validateOrder()` --- валидация данных.

###### Слой коммуникации

Класс LarekApi :

Этот класс будет использовать композицию, чтобы выполнить запрос на сервер с помощью метода get класса Api и будет получать с сервера объект с массивом товаров.

Методы класса LarekApi :

`getProductList(): Promise<IProduct[]>` --- получает массив товаров с сервера
`submitOrder(orderData: IOrderData): Promise<OrderResult>` --- отправляет данные заказа на сервер

# Документация слоя Представления (View).

## Базовые классы

1) Component<T>

Назначение: Абстрактный базовый класс для всех компонентов приложения. Предоставляет общие методы для работы с DOM.

Ключевые методы:

`render(data?: Partial<T>): HTMLElement` --- рендерит компонент с переданными данными

`setText(element: HTMLElement, value: unknown): void` --- устанавливает текстовое содержимое

`setImage(element: HTMLImageElement, src: string, alt?: string): void` --- устанавливает изображение

`toggleClass(element: HTMLElement, className: string, force?: boolean): void` --- управляет CSS-классами

`setDisabled(element: HTMLElement, state: boolean): void` --- блокирует/разблокирует элемент


2) Card

Назначение: Базовый класс для всех типов карточек товара. Содержит общую логику отображения товара.

Свойства класса Card :

`set title` --- название товара

`set image` --- URL изображения

`set category` --- категория товара (автоматически применяет CSS-класс)

`set price` --- цена товара


3) Modal

Назначение: Базовое модальное окно с оверлеем и функционалом закрытия.

Свойства класса Modal :

`set content` --- содержимое модального окна (HTMLElement)

`set open` - состояние открытия/закрытия

События класса Modal :

`modal:close` - при закрытии модального окна

### Классы 

1) CardCatalog

Назначение: Карточка товара в основном каталоге. Отображается в галерее товаров.

Свойства класса CardCatalog:

Наследует --- Card

Особенности --- Поддерживает обработку кликов по карточке

2) CardPreview

Назначение: Детальное представление товара для модального окна просмотра.

Наследует --- Card

Свойства класса CardPreview :

`set description` --- описание товара

`set buttonText` --- текст кнопки

3) CardBasket

Назначение: Представление товара в корзине. Включает управление количеством.

Свойства класса CardBasket :

`set index` --- порядковый номер в корзине

`set title` --- название товара

`set price `--- цена за единицу

4) ModalCard

Назначение: Модальное окно для детального просмотра товара.

Свойства класса ModalCard :

`set title`--- заголовок модального окна

Содержит: Компонент CardPreview

5) ModalBasket

Назначение: Модальное окно корзины с списком товаров и итоговой суммой.

Свойства класса ModalBasket :

`set list` --- массив элементов CardBasket

`set total` --- общая стоимость заказа

`set buttonDisabled` --- состояние кнопки оформления

6) ModalOrder

Назначение: Форма ввода адреса доставки и способа оплаты.

Свойства класса ModalOrder :

`set address` --- адрес доставки

`set buttonDisabled ` --- состояние кнопки продолжения

События класса ModalOrder :

`onPaymentChange`- при изменении способа оплаты

`onSubmit` - при отправке формы

Валидация:

Проверка заполнения адреса

Проверка выбора способа оплаты


7) ModalContacts

Назначение: Форма ввода контактных данных (email и телефон).

Свойства класса ModalContacts :

`set email` --- адрес электронной почты

`set phone` --- номер телефона

`set buttonDisabled` --- состояние кнопки отправки

Валидация:

Email должен содержать "@" и "."

Телефон должен содержать не менее 10 цифр

Визуальное отображение ошибок


8) ModalSuccess

Назначение: Окно подтверждения успешного оформления заказа.

Свойства класса ModalSuccess :

`set total` - сумма списания

### Главные компоненты

1) Page

Назначение: Главный компонент страницы. Управляет основными областями приложения.

Свойства класса Page :

`set catalog` --- массив карточек товаров для отображения в галерее

`set locked `--- блокировка интерфейса (при открытых модальных окнах)

2) Header

Назначение: Компонент шапки сайта с корзиной.

Свойства класса Header :

`set counter` --- количество товаров в корзине

События:

basket:open - при клике на иконку корзины

3) Basket

Назначение: Компонент корзины (может использоваться вне модального окна).

Свойства класса Basket :

`set list` --- список товаров в корзине

`set total` --- общая сумма заказа

События класса Basket :

`order:open ` --- при клике на кнопку оформления заказа

`basket:change ` --- при изменении содержимого корзины